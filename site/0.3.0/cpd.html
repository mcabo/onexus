<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at Oct 7, 2013
 | Rendered using Apache Maven Fluido Skin 1.2.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CPD Results</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido.min.js"></script>

    
    <meta name="Date-Revision-yyyymmdd" content="20131007" />
    <meta http-equiv="Content-Language" content="en" />
    
        </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="./" id="bannerLeft">
                <h2>Onexus</h2>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2013-10-07</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 0.3.0</li>
                      
                
            
      
                                  
    <li class="pull-right">              <a href="./" title="Onexus">Onexus</a>
  </li>

                        </ul>
      </div>

            <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
            
                                    <h3>Main</h3>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Welcome">Welcome</a>
            </li>
          </ul>
                        <h3>Documentation</h3>
                  <ul>
                  <li class="none">
                          <a href="docs/installation.html" title="Installation">Installation</a>
            </li>
                  <li class="none">
                          <a href="docs/compilation.html" title="Compilation">Compilation</a>
            </li>
          </ul>
                        <h3>Project Documentation</h3>
                  <ul>
                                                                                      <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                          <li class="expanded">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                    <ul>
                      <li class="none">
                          <a href="surefire-report.html" title="Surefire Report">Surefire Report</a>
            </li>
                      <li class="none">
                          <a href="xref-test/index.html" title="Test Source Xref">Test Source Xref</a>
            </li>
                      <li class="none">
                          <a href="xref/index.html" title="Source Xref">Source Xref</a>
            </li>
                      <li class="none">
            <strong>CPD Report</strong>
          </li>
                      <li class="none">
                          <a href="pmd.html" title="PMD Report">PMD Report</a>
            </li>
                      <li class="none">
                          <a href="apidocs/index.html" title="JavaDocs">JavaDocs</a>
            </li>
                      <li class="none">
                          <a href="testapidocs/index.html" title="Test JavaDocs">Test JavaDocs</a>
            </li>
              </ul>
        </li>
          </ul>
                        <h3>Modules</h3>
                  <ul>
                  <li class="none">
                          <a href="org.onexus.collection.api/index.html" title="org.onexus.collection.api">org.onexus.collection.api</a>
            </li>
                  <li class="none">
                          <a href="org.onexus.collection.manager/index.html" title="org.onexus.collection.manager">org.onexus.collection.manager</a>
            </li>
                  <li class="none">
                          <a href="org.onexus.collection.store.sql/index.html" title="org.onexus.collection.store.sql">org.onexus.collection.store.sql</a>
            </li>
                  <li class="none">
                          <a href="org.onexus.collection.store.mysql/index.html" title="org.onexus.collection.store.mysql">org.onexus.collection.store.mysql</a>
            </li>
                  <li class="none">
                          <a href="org.onexus.collection.store.h2sql/index.html" title="org.onexus.collection.store.h2sql">org.onexus.collection.store.h2sql</a>
            </li>
                  <li class="none">
                          <a href="org.onexus.collection.query.parser/index.html" title="org.onexus.collection.query.parser">org.onexus.collection.query.parser</a>
            </li>
                  <li class="none">
                          <a href="org.onexus.collection.loader.tsv/index.html" title="org.onexus.collection.loader.tsv">org.onexus.collection.loader.tsv</a>
            </li>
                  <li class="none">
                          <a href="org.onexus.resource.api/index.html" title="org.onexus.resource.api">org.onexus.resource.api</a>
            </li>
                  <li class="none">
                          <a href="org.onexus.resource.manager/index.html" title="org.onexus.resource.manager">org.onexus.resource.manager</a>
            </li>
                  <li class="none">
                          <a href="org.onexus.resource.authorization/index.html" title="org.onexus.resource.authorization">org.onexus.resource.authorization</a>
            </li>
                  <li class="none">
                          <a href="org.onexus.resource.profile/index.html" title="org.onexus.resource.profile">org.onexus.resource.profile</a>
            </li>
                  <li class="none">
                          <a href="org.onexus.resource.progress/index.html" title="org.onexus.resource.progress">org.onexus.resource.progress</a>
            </li>
                  <li class="none">
                          <a href="org.onexus.resource.serializer.xstream/index.html" title="org.onexus.resource.serializer.xstream">org.onexus.resource.serializer.xstream</a>
            </li>
                  <li class="none">
                          <a href="org.onexus.data.api/index.html" title="org.onexus.data.api">org.onexus.data.api</a>
            </li>
                  <li class="none">
                          <a href="org.onexus.data.manager/index.html" title="org.onexus.data.manager">org.onexus.data.manager</a>
            </li>
                  <li class="none">
                          <a href="org.onexus.data.loader.file/index.html" title="org.onexus.data.loader.file">org.onexus.data.loader.file</a>
            </li>
                  <li class="none">
                          <a href="org.onexus.website.api/index.html" title="org.onexus.website.api">org.onexus.website.api</a>
            </li>
                  <li class="none">
                          <a href="org.onexus.ui.authentication.persona/index.html" title="org.onexus.ui.authentication.persona">org.onexus.ui.authentication.persona</a>
            </li>
                  <li class="none">
                          <a href="org.onexus.ui.authentication.jaas/index.html" title="org.onexus.ui.authentication.jaas">org.onexus.ui.authentication.jaas</a>
            </li>
                  <li class="none">
                          <a href="org.onexus.ui.api/index.html" title="org.onexus.ui.api">org.onexus.ui.api</a>
            </li>
                  <li class="none">
                          <a href="org.onexus.ui.workspace/index.html" title="org.onexus.ui.workspace">org.onexus.ui.workspace</a>
            </li>
                  <li class="none">
                          <a href="org.onexus.ui.website/index.html" title="org.onexus.ui.website">org.onexus.ui.website</a>
            </li>
                  <li class="none">
                          <a href="onexus-archetypes/onexus-archetype-widget/index.html" title="Onexus :: Archetypes :: Widget">Onexus :: Archetypes :: Widget</a>
            </li>
                  <li class="none">
                          <a href="onexus-features/index.html" title="Onexus :: Features">Onexus :: Features</a>
            </li>
          </ul>
                      
            
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
        <div id="bodyColumn"  class="span9" >
                                  
            <div class="section"><h2>CPD Results<a name="CPD_Results"></a></h2><p>The following document contains the results of PMD's  <a class="externalLink" href="http://pmd.sourceforge.net/cpd.html">CPD</a> 5.0.2.</p></div><div class="section"><h2>Duplications<a name="Duplications"></a></h2><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Project</th><th>Line</th></tr><tr class="b"><td>org/onexus/ui/api/pages/error/ExceptionErrorPage.java</td><td>org.onexus.ui.api</td><td><a href="./xref/org/onexus/ui/api/pages/error/ExceptionErrorPage.html#31">31</a></td></tr><tr class="a"><td>org/onexus/website/api/utils/error/ExceptionErrorPage.java</td><td>org.onexus.website.api</td><td><a href="./xref/org/onexus/website/api/utils/error/ExceptionErrorPage.html#33">33</a></td></tr><tr class="b"><td colspan='3'><div><pre>public class ExceptionErrorPage extends AbstractErrorPage {
    private static final long serialVersionUID = 1L;

    /**
     * Keep a reference to the root cause. WicketTester will use it
     */
    private final transient Throwable throwable;

    /**
     * Constructor.
     *
     * @param throwable The exception to show
     */
    public ExceptionErrorPage(final Throwable throwable) {
        this.throwable = throwable;

        add(new DefaultTheme());

        // Add exception label
        add(new MultiLineLabel(&quot;exception&quot;, getErrorMessage(throwable)));

        add(new MultiLineLabel(&quot;stacktrace&quot;, getStackTrace(throwable)));

    }

    /**
     * Converts a Throwable to a string.
     *
     * @param throwable The throwable
     * @return The string
     */
    public String getErrorMessage(final Throwable throwable) {
        if (throwable != null) {
            StringBuilder sb = new StringBuilder(256);

            // first print the last cause or the first onexus exception
            Throwable cause = null;
            List&lt;Throwable&gt; al = convertToList(throwable);
            for (Throwable e : al) {
                if (OnexusException.class.isAssignableFrom(e.getClass())) {
                    cause = e;
                    break;
                }
            }

            if (cause == null) {
                int length = al.size() - 1;
                cause = al.get(length);
            }

            sb.append(cause.getMessage());
            return sb.toString();
        } else {
            return &quot;[Unknown]&quot;;
        }
    }

    /**
     * Converts a Throwable to a string.
     *
     * @param throwable The throwable
     * @return The string
     */
    public String getStackTrace(final Throwable throwable) {
        if (throwable != null) {
            List&lt;Throwable&gt; al = convertToList(throwable);

            StringBuilder sb = new StringBuilder(256);

            // first print the last cause
            int length = al.size() - 1;
            Throwable cause = al.get(length);

            outputThrowable(cause, sb, false);

            if (length &gt; 0) {
                sb.append(&quot;\n\nComplete stack:\n\n&quot;);
                for (int i = 0; i &lt; length; i++) {
                    outputThrowable(al.get(i), sb, true);
                    sb.append(&quot;\n&quot;);
                }
            }
            return sb.toString();
        } else {
            return &quot;&lt;Null Throwable&gt;&quot;;
        }
    }

    /**
     * @param throwable
     * @return xxx
     */
    private List&lt;Throwable&gt; convertToList(final Throwable throwable) {
        List&lt;Throwable&gt; al = Generics.newArrayList();
        Throwable cause = throwable;
        al.add(cause);
        while (cause.getCause()!=null &amp;&amp; cause!=cause.getCause()) {
            cause = cause.getCause();
            al.add(cause);
        }
        return al;
    }

    /**
     * Outputs the throwable and its stacktrace to the stringbuffer. If stopAtWicketSerlvet is true
     * then the output will stop when the org.apache.wicket servlet is reached. sun.reflect.
     * packages are filtered out.
     *
     * @param cause
     * @param sb
     * @param stopAtWicketServlet
     */
    private void outputThrowable(Throwable cause, StringBuilder sb, boolean stopAtWicketServlet) {
        sb.append(cause);
        sb.append(&quot;\n&quot;);
        StackTraceElement[] trace = cause.getStackTrace();
        for (int i = 0; i &lt; trace.length; i++) {
            String traceString = trace[i].toString();
            if (!(traceString.startsWith(&quot;sun.reflect.&quot;) &amp;&amp; i &gt; 1)) {
                sb.append(&quot;     at &quot;);
                sb.append(traceString);
                sb.append(&quot;\n&quot;);
                if (stopAtWicketServlet &amp;&amp;
                        (traceString.startsWith(&quot;org.apache.wicket.protocol.http.WicketServlet&quot;) || traceString.startsWith(&quot;org.apache.wicket.protocol.http.WicketFilter&quot;))) {
                    return;
                }
            }
        }
    }

    @Override
    protected void setHeaders(final WebResponse response) {
        response.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);
    }

    /**
     * Get access to the exception
     *
     * @return The exception
     */
    public Throwable getThrowable() {
        return throwable;
    }</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Project</th><th>Line</th></tr><tr class="b"><td>org/onexus/website/api/pages/browser/filters/panels/DoubleFilterPanel.java</td><td>org.onexus.website.api</td><td><a href="./xref/org/onexus/website/api/pages/browser/filters/panels/DoubleFilterPanel.html#71">71</a></td></tr><tr class="a"><td>org/onexus/website/api/pages/browser/filters/panels/IntegerFilterPanel.java</td><td>org.onexus.website.api</td><td><a href="./xref/org/onexus/website/api/pages/browser/filters/panels/IntegerFilterPanel.html#71">71</a></td></tr><tr class="b"><td colspan='3'><div><pre>        form.add(new TextField&lt;Double&gt;(&quot;value&quot;));

        form.add(new AjaxSubmitLink(&quot;submit&quot;) {
            @Override
            protected void onSubmit(AjaxRequestTarget target, Form&lt;?&gt; form) {

                FilterOption fo = option.getObject();
                String title = header.getLabel() + &quot; &quot; + fo.getOperation() + &quot; '&quot; + fo.getValue() + &quot;'&quot;;
                FilterConfig fc = new FilterConfig(title);

                fc.setCollection(header.getCollection().getORI());
                fc.setDefine(&quot;fc='&quot; + fc.getCollection() + &quot;'&quot;);

                Filter where;
                String operation = fo.getOperation();

                if (EQ.equals(operation)) {
                    where = new Equal(&quot;fc&quot;, header.getField().getId(), fo.getValue());
                } else if (NOT_EQ.equals(operation)) {
                    where = new NotEqual(&quot;fc&quot;, header.getField().getId(), fo.getValue());
                } else if (GT_EQ.equals(operation)) {
                    where = new GreaterThanOrEqual(&quot;fc&quot;, header.getField().getId(), fo.getValue());
                } else if (LT_EQ.equals(operation)) {
                    where = new LessThanOrEqual(&quot;fc&quot;, header.getField().getId(), fo.getValue());
                } else if (GT.equals(operation)) {
                    where = new GreaterThan(&quot;fc&quot;, header.getField().getId(), fo.getValue());
                } else {
                    where = new LessThan(&quot;fc&quot;, header.getField().getId(), fo.getValue());
                }

                fc.setWhere(where.toString());

                addFilter(target, fc);
            }

            @Override
            protected void onError(AjaxRequestTarget target, Form&lt;?&gt; form) {
                target.add(feedbackPanel);
            }
        });

        add(form);
    }

    protected abstract void addFilter(AjaxRequestTarget target, FilterConfig filterConfig);

    public static class FilterOption implements Serializable {
        private String operation;
        private Double value;</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Project</th><th>Line</th></tr><tr class="b"><td>org/onexus/ui/api/wizards/AbstractNewResourceWizard.java</td><td>org.onexus.ui.api</td><td><a href="./xref/org/onexus/ui/api/wizards/AbstractNewResourceWizard.html#71">71</a></td></tr><tr class="a"><td>org/onexus/ui/website/internal/wizards/AbstractNewResourceWizard.java</td><td>org.onexus.ui.website</td><td><a href="./xref/org/onexus/ui/website/internal/wizards/AbstractNewResourceWizard.html#73">73</a></td></tr><tr class="b"><td colspan='3'><div><pre>            setResponsePage(ResourcesPage.class, params);
        }

        super.onFinish();
    }

    public T getResource() {
        return resource;
    }

    public void setResource(T resource) {
        this.resource = resource;
    }

    protected ORI getParentUri() {
        return this.parentUri;
    }

    protected RequiredTextField&lt;String&gt; getFieldResourceName() {
        final RequiredTextField&lt;String&gt; resourceName = new RequiredTextField&lt;String&gt;(&quot;resource.label&quot;);
        resourceName.setOutputMarkupId(true);
        resourceName.add(new PatternValidator(&quot;[\\w-.\\+]*&quot;));
        resourceName.add(new DuplicatedResourceValidator());

        resourceName.add(new AjaxFormValidatingBehavior(getForm(), &quot;onchange&quot;) {
            @Override
            protected void updateAjaxAttributes(final AjaxRequestAttributes attributes) {
                super.updateAjaxAttributes(attributes);

                String id = &quot;throttle-&quot; + resourceName.getMarkupId();
                ThrottlingSettings throttlingSettings = new ThrottlingSettings(id, Duration.seconds(1));
                attributes.setThrottlingSettings(throttlingSettings);
            }
        });

        return resourceName;
    }

    public class DuplicatedResourceValidator extends Behavior implements IValidator&lt;String&gt; {

        @Override
        public void validate(IValidatable&lt;String&gt; validatable) {

            if (parentUri != null &amp;&amp; resource != null &amp;&amp; resource.getLabel() != null) {

                ORI resourceORI = new ORI(parentUri, validatable.getValue());

                Resource test = resourceManager.load(Resource.class, resourceORI);

                if (test != null) {
                    validatable.error(new ValidationError(&quot;duplicated-resource&quot;));
                }


            }


        }
    }

}</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Project</th><th>Line</th></tr><tr class="b"><td>org/onexus/collection/manager/internal/ws/OqlServlet.java</td><td>org.onexus.collection.manager</td><td><a href="./xref/org/onexus/collection/manager/internal/ws/OqlServlet.html#154">154</a></td></tr><tr class="a"><td>org/onexus/website/api/widgets/download/formats/TsvFormat.java</td><td>org.onexus.website.api</td><td><a href="./xref/org/onexus/website/api/widgets/download/formats/TsvFormat.html#74">74</a></td></tr><tr class="b"><td colspan='3'><div><pre>                    label = select.getKey() + &quot;.&quot; + field.getId();
                }

                response.write(label);

                if (fieldId.hasNext() || selectIt.hasNext()) {
                    response.write(&quot;\t&quot;);
                }
            }

        }


        response.write(&quot;\n&quot;);
    }

    private static void writeRow(PrintWriter response, IEntityTable table) {

        Iterator&lt;Map.Entry&lt;String, List&lt;String&gt;&gt;&gt; selectIt = table.getQuery().getSelect().entrySet().iterator();
        while (selectIt.hasNext()) {
            Map.Entry&lt;String, List&lt;String&gt;&gt; select = selectIt.next();

            ORI collection = QueryUtils.getCollectionOri(table.getQuery(), select.getKey());
            IEntity entity = table.getEntity(collection);

            Iterator&lt;String&gt; fieldId = select.getValue().iterator();
            while (fieldId.hasNext()) {
                response.write(String.valueOf(entity.get(fieldId.next())));
                if (fieldId.hasNext() || selectIt.hasNext()) {
                    response.write(&quot;\t&quot;);
                }
            }
        }

        response.write(&quot;\n&quot;);
    }</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Project</th><th>Line</th></tr><tr class="b"><td>org/onexus/ui/api/utils/panels/icons/Icons.java</td><td>org.onexus.ui.api</td><td><a href="./xref/org/onexus/ui/api/utils/panels/icons/Icons.html#23">23</a></td></tr><tr class="a"><td>org/onexus/website/api/utils/panels/icons/Icons.java</td><td>org.onexus.website.api</td><td><a href="./xref/org/onexus/website/api/utils/panels/icons/Icons.html#23">23</a></td></tr><tr class="b"><td colspan='3'><div><pre>public final class Icons {

    private Icons() {
        super();
    }

    /**
     * Cross icon.
     */
    public static final ResourceReference CROSS = new PackageResourceReference(
            Icons.class, &quot;cross.png&quot;);

    /**
     * Question mark icon.
     */
    public static final ResourceReference HELP = new PackageResourceReference(
            Icons.class, &quot;b_help.png&quot;);

    /**
     * Thin delete icon.
     */
    public static final ResourceReference THIN_DELETE = new PackageResourceReference(
            Icons.class, &quot;thin_delete.png&quot;);

    /**
     * Rounded informative icon (i).
     */
    public static final ResourceReference INFORMATION = new PackageResourceReference(
            Icons.class, &quot;information.png&quot;);

    /**
     * Arrow right (usually to uncollapse).
     */
    public static final ResourceReference ARROW_RIGHT = new PackageResourceReference(
            Icons.class, &quot;arrow-right.png&quot;);

    /**
     * Arrow right (usually to collapse).
     */
    public static final ResourceReference ARROW_DOWN = new PackageResourceReference(
            Icons.class, &quot;arrow-down.png&quot;);

    /**
     * Disk icon
     */
    public static final ResourceReference DISK = new PackageResourceReference(
            Icons.class, &quot;disk.png&quot;);

    /**
     * Add icon
     */
    public static final ResourceReference ADDITION = new PackageResourceReference(Icons.class, &quot;addition.png&quot;);

    /**
     * Edit page
     */
    public static final ResourceReference EDIT_PAGE = new PackageResourceReference(Icons.class, &quot;page-white_edit.png&quot;);


    /**
     * Eye icon
     */
    public static final ResourceReference EYE = new PackageResourceReference(
            Icons.class, &quot;eye.png&quot;);


    /**
     * Dark eye icon
     */
    public static final ResourceReference EYE_DARK = new PackageResourceReference(
            Icons.class, &quot;eye-dark.png&quot;);

    /**
     * Done mark
     */
    public static final ResourceReference DONE = new PackageResourceReference(
            Icons.class, &quot;done.gif&quot;);

    /**
     * Loading icon
     */
    public static final ResourceReference LOADING = new PackageResourceReference(
            Icons.class, &quot;loading.gif&quot;);


}</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Project</th><th>Line</th></tr><tr class="b"><td>org/onexus/ui/api/OnexusWebSession.java</td><td>org.onexus.ui.api</td><td><a href="./xref/org/onexus/ui/api/OnexusWebSession.html#76">76</a></td></tr><tr class="a"><td>org/onexus/website/api/WebsiteSession.java</td><td>org.onexus.website.api</td><td><a href="./xref/org/onexus/website/api/WebsiteSession.html#76">76</a></td></tr><tr class="b"><td colspan='3'><div><pre>        if (OnexusWebApplication.get().usePersonSignIn()) {
            return authenticatePersona(username);
        }

        boolean authenticated = false;
        LoginCallbackHandler handler = new LoginCallbackHandler(username, password);
        try {
            javax.security.auth.login.LoginContext javaCtx = new javax.security.auth.login.LoginContext(APPLICATION_POLICY_NAME, handler);
            javaCtx.login();
            authenticated = true;

            LoginContext ctx = new LoginContext(username);

            Subject subject = javaCtx.getSubject();
            if (subject != null) {
                for (Principal p : subject.getPrincipals()) {
                    ctx.addRole(p.getName());
                }
            }

            LoginContext.set(ctx, getId());

        } catch (LoginException e) {
            // You'll get a LoginException on a failed username/password combo.
            authenticated = false;
            LoginContext.set(LoginContext.ANONYMOUS_CONTEXT, null);
        }
        return authenticated;
    }

    private boolean authenticatePersona(String username) {
        if (!Strings.isEmpty(username)) {
            LoginContext ctx = new LoginContext(username);
            for (String role : PersonaRoles.getPersonaRoles(username)) {
                ctx.addRole(role);
            }
            LoginContext.set(ctx, getId());</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Project</th><th>Line</th></tr><tr class="b"><td>org/onexus/ui/api/OnexusWebApplication.java</td><td>org.onexus.ui.api</td><td><a href="./xref/org/onexus/ui/api/OnexusWebApplication.html#53">53</a></td></tr><tr class="a"><td>org/onexus/website/api/WebsiteApplication.java</td><td>org.onexus.website.api</td><td><a href="./xref/org/onexus/website/api/WebsiteApplication.html#66">66</a></td></tr><tr class="b"><td colspan='3'><div><pre>    }

    @Override
    protected void init() {
        super.init();

        // Authentication
        getApplicationSettings().setAccessDeniedPage(getSignInPageClass());

        /* In case of unhandled exception redirect it to a custom page */
        getRequestCycleListeners().add(new AbstractRequestCycleListener() {
            @Override
            public IRequestHandler onException(RequestCycle cycle, Exception e) {
                return new RenderPageRequestHandler(new PageProvider(new ExceptionErrorPage(e)));
            }
        });

        // Set the login context on each thread
        getRequestCycleListeners().add(new AbstractRequestCycleListener() {
            @Override
            public void onBeginRequest(RequestCycle cycle) {
                HttpServletRequest webRequest = (HttpServletRequest) cycle.getRequest().getContainerRequest();
                HttpSession session = webRequest.getSession();

                if (session != null &amp;&amp; LoginContext.get(session.getId()) != null) {
                    LoginContext.set(LoginContext.get(session.getId()), null);
                } else {
                    LoginContext.set(LoginContext.ANONYMOUS_CONTEXT, null);
                }
            }
        });

        // Mount pages
        mountPage(&quot;/login&quot;, getSignInPageClass());</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Project</th><th>Line</th></tr><tr class="b"><td>org/onexus/ui/api/OnexusWebSession.java</td><td>org.onexus.ui.api</td><td><a href="./xref/org/onexus/ui/api/OnexusWebSession.html#112">112</a></td></tr><tr class="a"><td>org/onexus/website/api/WebsiteSession.java</td><td>org.onexus.website.api</td><td><a href="./xref/org/onexus/website/api/WebsiteSession.html#112">112</a></td></tr><tr class="b"><td colspan='3'><div><pre>            LoginContext.set(ctx, getId());

            return true;
        }

        LoginContext.set(LoginContext.ANONYMOUS_CONTEXT, null);
        return false;
    }

    private class LoginCallbackHandler implements CallbackHandler {

        private String username;
        private String password;

        public LoginCallbackHandler(String username, String password) {
            this.username = username;
            this.password = password;
        }

        public void handle(Callback[] callbacks) throws IOException, UnsupportedCallbackException {
            for (int i = 0; i &lt; callbacks.length; i++) {
                Callback callback = callbacks[i];
                if (callback instanceof NameCallback) {
                    ((NameCallback) callback).setName(username);
                } else if (callback instanceof PasswordCallback) {
                    PasswordCallback pwCallback = (PasswordCallback) callback;
                    pwCallback.setPassword(password.toCharArray());
                } else {
                    throw new UnsupportedCallbackException(callbacks[i], &quot;Callback type not supported&quot;);
                }
            }
        }
    }


}</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Project</th><th>Line</th></tr><tr class="b"><td>org/onexus/website/api/pages/browser/filters/panels/CategoricalFilterPanel.java</td><td>org.onexus.website.api</td><td><a href="./xref/org/onexus/website/api/pages/browser/filters/panels/CategoricalFilterPanel.html#62">62</a></td></tr><tr class="a"><td>org/onexus/website/api/pages/browser/filters/panels/StringFilterPanel.java</td><td>org.onexus.website.api</td><td><a href="./xref/org/onexus/website/api/pages/browser/filters/panels/StringFilterPanel.html#59">59</a></td></tr><tr class="b"><td colspan='3'><div><pre>        form.add(new DropDownChoice&lt;String&gt;(&quot;value&quot;, values).setNullValid(false));

        form.add(new AjaxSubmitLink(&quot;submit&quot;) {
            @Override
            protected void onSubmit(AjaxRequestTarget target, Form&lt;?&gt; form) {

                FilterOption fo = option.getObject();
                String value = fo.getValue();

                String title = header.getLabel() + &quot; &quot; + fo.getOperation() + &quot; '&quot; + value + &quot;'&quot;;
                FilterConfig fc = new FilterConfig(title);

                fc.setCollection(header.getCollection().getORI());
                fc.setDefine(&quot;fc='&quot; + fc.getCollection() + &quot;'&quot;);

                Filter where;
                if (EQUAL.equals(fo.getOperation())) {
                    where = new Equal(&quot;fc&quot;, header.getField().getId(), value.trim());</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Project</th><th>Line</th></tr><tr class="b"><td>org/onexus/ui/api/OnexusWebSession.java</td><td>org.onexus.ui.api</td><td><a href="./xref/org/onexus/ui/api/OnexusWebSession.html#45">45</a></td></tr><tr class="a"><td>org/onexus/website/api/WebsiteSession.java</td><td>org.onexus.website.api</td><td><a href="./xref/org/onexus/website/api/WebsiteSession.html#45">45</a></td></tr><tr class="b"><td colspan='3'><div><pre>    public OnexusWebSession(Request request) {
        super(request);

        HttpServletRequest webRequest = (HttpServletRequest) request.getContainerRequest();
        HttpSession session = webRequest.getSession();

        if (session != null &amp;&amp; LoginContext.get(session.getId()) != null) {
            LoginContext.set(LoginContext.get(session.getId()), null);
        } else {
            LoginContext.set(LoginContext.ANONYMOUS_CONTEXT, null);
        }
    }

    @Override
    public Roles getRoles() {
        Roles roles = new Roles();
        roles.addAll(LoginContext.get().getRoles());
        return roles;
    }

    @Override
    public boolean isSignedIn() {
        return LoginContext.get().getUserName() != null;
    }

    public static OnexusWebSession get() {</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Project</th><th>Line</th></tr><tr class="b"><td>org/onexus/resource/manager/internal/ws/git/GitSecurityFilter.java</td><td>org.onexus.resource.manager</td><td><a href="./xref/org/onexus/resource/manager/internal/ws/git/GitSecurityFilter.html#225">225</a></td></tr><tr class="a"><td>org/onexus/ui/api/OnexusWebSession.java</td><td>org.onexus.ui.api</td><td><a href="./xref/org/onexus/ui/api/OnexusWebSession.html#119">119</a></td></tr><tr class="b"><td>org/onexus/website/api/WebsiteSession.java</td><td>org.onexus.website.api</td><td><a href="./xref/org/onexus/website/api/WebsiteSession.html#118">118</a></td></tr><tr class="a"><td colspan='3'><div><pre>    }

    private class LoginCallbackHandler implements CallbackHandler {

        private String username;
        private String password;

        public LoginCallbackHandler(String username, String password) {
            this.username = username;
            this.password = password;
        }

        public void handle(Callback[] callbacks) throws IOException, UnsupportedCallbackException {
            for (int i = 0; i &lt; callbacks.length; i++) {
                Callback callback = callbacks[i];
                if (callback instanceof NameCallback) {
                    ((NameCallback) callback).setName(username);
                } else if (callback instanceof PasswordCallback) {
                    PasswordCallback pwCallback = (PasswordCallback) callback;
                    pwCallback.setPassword(password.toCharArray());
                } else {
                    throw new UnsupportedCallbackException(callbacks[i], &quot;Callback type not supported&quot;);
                }
            }
        }
    }</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="b"><th>File</th><th>Project</th><th>Line</th></tr><tr class="a"><td>org/onexus/website/api/widgets/download/formats/ExcelFormat.java</td><td>org.onexus.website.api</td><td><a href="./xref/org/onexus/website/api/widgets/download/formats/ExcelFormat.html#82">82</a></td></tr><tr class="b"><td>org/onexus/website/api/widgets/download/formats/TsvFormat.java</td><td>org.onexus.website.api</td><td><a href="./xref/org/onexus/website/api/widgets/download/formats/TsvFormat.html#60">60</a></td></tr><tr class="a"><td colspan='3'><div><pre>        while (selectIt.hasNext()) {
            Map.Entry&lt;String, List&lt;String&gt;&gt; select = selectIt.next();

            ORI collectionUri = QueryUtils.getCollectionOri(table.getQuery(), select.getKey());
            Collection collection = getResourceManager().load(Collection.class, collectionUri);

            Iterator&lt;String&gt; fieldId = select.getValue().iterator();
            while (fieldId.hasNext()) {
                Field field = collection.getField(fieldId.next());
                if (field == null) {
                    continue;
                }
                String label = field.getLabel();
                if (label == null) {
                    label = field.getId();
                }</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="b"><th>File</th><th>Project</th><th>Line</th></tr><tr class="a"><td>org/onexus/ui/api/wizards/AbstractWizard.java</td><td>org.onexus.ui.api</td><td><a href="./xref/org/onexus/ui/api/wizards/AbstractWizard.html#59">59</a></td></tr><tr class="b"><td>org/onexus/ui/website/internal/wizards/AbstractWizard.java</td><td>org.onexus.ui.website</td><td><a href="./xref/org/onexus/ui/website/internal/wizards/AbstractWizard.html#60">60</a></td></tr><tr class="a"><td colspan='3'><div><pre>    protected Form&lt;AbstractWizard&gt; newForm(String id) {

        Form&lt;AbstractWizard&gt; form = new Form&lt;AbstractWizard&gt;(id, new CompoundPropertyModel&lt;AbstractWizard&gt;(this));
        form.setOutputMarkupId(true);

        return form;

    }


    /**
     * This is a hack, because we expect that the finish button is enabled only
     * if the last step is completed. By default, finish button is always
     * enabled on the last step.
     *
     * @author Jordi Deu-Pons
     */
    public static final class MyWizardButtonBar extends WizardButtonBar implements IDefaultButtonProvider {

        public MyWizardButtonBar(String id, IWizard wizard) {
            super(id, wizard);
            replace(new FinishButton(&quot;finish&quot;, wizard) {

                @Override
                public boolean isEnabled() {
                    IWizardStep activeStep = getWizardModel().getActiveStep();
                    return activeStep!=null &amp;&amp; getWizardModel().isLastStep(activeStep) &amp;&amp; activeStep.isComplete();
                }

            });
        }

    }

}</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="b"><th>File</th><th>Project</th><th>Line</th></tr><tr class="a"><td>org/onexus/ui/api/pages/resource/ResourcesPage.java</td><td>org.onexus.ui.api</td><td><a href="./xref/org/onexus/ui/api/pages/resource/ResourcesPage.html#90">90</a></td></tr><tr class="b"><td>org/onexus/ui/api/pages/resource/ResourcesPage.java</td><td>org.onexus.ui.api</td><td><a href="./xref/org/onexus/ui/api/pages/resource/ResourcesPage.html#127">127</a></td></tr><tr class="a"><td colspan='3'><div><pre>                getResourceManager().syncProject(resourceUri.getProjectUrl());

                Resource newVersion = getResourceManager().load(Resource.class, resourceUri);
                if (newVersion == null) {
                    resourceUri = resourceUri.getParent();

                    newVersion = getResourceManager().load(Resource.class, resourceUri);
                    if (newVersion == null) {
                        resourceUri = new ORI(resourceUri.getProjectUrl(), null);
                    }
                }

                PageParameters parameters = new PageParameters();
                parameters.set(ResourcesPage.PARAMETER_RESOURCE, resourceUri);

                setResponsePage(ResourcesPage.class, parameters);
            }
        }

        @Override
        public boolean isVisible() {
            return ResourcesPage.this.getModelObject() != null;
        }
    }

    public class ToolProjectUpdate extends Link&lt;Resource&gt; {</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="b"><th>File</th><th>Project</th><th>Line</th></tr><tr class="a"><td>org/onexus/ui/api/utils/panels/HelpMark.java</td><td>org.onexus.ui.api</td><td><a href="./xref/org/onexus/ui/api/utils/panels/HelpMark.html#35">35</a></td></tr><tr class="b"><td>org/onexus/website/api/utils/panels/HelpMark.java</td><td>org.onexus.website.api</td><td><a href="./xref/org/onexus/website/api/utils/panels/HelpMark.html#35">35</a></td></tr><tr class="a"><td colspan='3'><div><pre>public class HelpMark extends Panel {

    /**
     * @param panelId  Wicket component id.
     * @param title    Modal window title.
     * @param helpText Text to show into the modal window.
     */
    public HelpMark(final String panelId, final String title,
                    final String helpText) {
        this(panelId, title, &quot;&quot;, helpText);
    }

    public HelpMark(final String panelId, final String title,
                    final String displayLabel, final String helpText) {
        super(panelId);

        // Add modal window
        final ModalWindow modal = new ModalWindow(&quot;modalWindowEmbeeded&quot;);
        modal.setTitle(title);
        modal.setInitialWidth(700);
        modal.setInitialHeight(500);
        add(modal);

        // Add mark label
        final WebMarkupContainer container = new WebMarkupContainer(
                &quot;displayLabel&quot;);
        container.add(new Label(&quot;label&quot;, displayLabel));
        add(container);

        // Add question mark icon
        Image img = null;</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="b"><th>File</th><th>Project</th><th>Line</th></tr><tr class="a"><td>org/onexus/website/api/pages/browser/SelectionPanel.java</td><td>org.onexus.website.api</td><td><a href="./xref/org/onexus/website/api/pages/browser/SelectionPanel.html#112">112</a></td></tr><tr class="b"><td>org/onexus/website/api/pages/browser/filters/FiltersToolbar.java</td><td>org.onexus.website.api</td><td><a href="./xref/org/onexus/website/api/pages/browser/filters/FiltersToolbar.html#54">54</a></td></tr><tr class="a"><td colspan='3'><div><pre>        widgetModal = new WebMarkupContainer(&quot;widgetModal&quot;);
        widgetModal.setOutputMarkupId(true);

        widgetModal.add(new EmptyPanel(&quot;widget&quot;));

        widgetModal.add(new AjaxLink&lt;String&gt;(&quot;close&quot;) {

            @Override
            public void onClick(AjaxRequestTarget target) {
                Component widget = widgetModal.get(&quot;widget&quot;);
                if (widget instanceof Widget) {
                    ((Widget) widget).onClose(target);
                }
                target.appendJavaScript(&quot;$('#&quot; + widgetModal.getMarkupId() + &quot;').modal('hide')&quot;);
            }
        });

        add(widgetModal);

        widgetModal.add(new Label(&quot;modalHeader&quot;, &quot;Selection details&quot;));</pre></div></td></tr></table></div>
                  </div>
            </div>
      
    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span16">Copyright &copy;                    2013
                        <a href="http://www.onexus.org">Onexus</a>.
            All Rights Reserved.      
            
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
