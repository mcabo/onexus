<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
           xmlns:cm="http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.1.0">

    <cm:property-placeholder persistent-id="org.onexus.ui.workspace" update-strategy="reload">
        <cm:default-properties>
            <cm:property name="urlPrefix" value="/onexus"/>
            <cm:property name="database" value="onexus-h2-tags"/>
            <cm:property name="username" value="sa"/>
            <cm:property name="password" value=""/>
        </cm:default-properties>
    </cm:property-placeholder>

    <!-- ITagStoreManager -->
    <service interface="org.onexus.ui.website.widgets.tags.tagstore.ITagStoreManager"
             ref="org.onexus.ui.website.widgets.tags.tagstore"/>
    <bean id="org.onexus.ui.website.widgets.tags.tagstore"
          class="org.onexus.ui.website.widgets.tags.tagstore.TagStoreManager" init-method="init">
        <property name="database" value="${database}"></property>
        <property name="username" value="${username}"></property>
        <property name="password" value="${password}"></property>
    </bean>

    <!-- IResourceRegister -->
    <reference id="serializerRef" interface="org.onexus.core.IResourceSerializer"/>
    <reference-list id="resourceActivatorsRef" interface="org.onexus.ui.IResourceActivator" availability="optional">
        <reference-listener bind-method="bindActivators" unbind-method="unbindActivators"
                            ref="org.onexus.ui.resourceregister"/>
    </reference-list>
    <service interface="org.onexus.ui.IResourceRegister" ref="org.onexus.ui.resourceregister"/>
    <bean id="org.onexus.ui.resourceregister" class="org.onexus.ui.DefaultResourceRegister">
        <property name="resourceActivators" ref="resourceActivatorsRef"/>
        <property name="serializer" ref="serializerRef"/>
    </bean>

    <!-- Default ViewersCreators -->
    <service interface="org.onexus.ui.IViewerCreator">
        <bean class="org.onexus.ui.wizards.WizardViewerTab"/>
    </service>
    <service interface="org.onexus.ui.IViewerCreator">
        <bean class="org.onexus.ui.editor.EditorViewerTab"/>
    </service>
    <service interface="org.onexus.ui.IViewerCreator">
        <bean class="org.onexus.ui.website.workspace.PreviewBrowserViewerTab"/>
    </service>
    <service interface="org.onexus.ui.IViewerCreator">
        <bean class="org.onexus.ui.website.workspace.CollectionViewerTab"/>
    </service>

    <!-- Default Viewers manager -->
    <reference-list id="viewerCreatorsRef" interface="org.onexus.ui.IViewerCreator" availability="optional"/>
    <service interface="org.onexus.ui.workspace.viewers.IViewersManager">
        <bean class="org.onexus.ui.workspace.viewers.DefaultViewersManager">
            <property name="viewerCreators" ref="viewerCreatorsRef"/>
        </bean>
    </service>


    <!-- Default wizards -->
    <service interface="org.onexus.ui.IWizardCreator">
        <bean class="org.onexus.ui.wizards.creators.NewProjectWizardCreator"/>
    </service>
    <service interface="org.onexus.ui.IWizardCreator">
        <bean class="org.onexus.ui.wizards.creators.NewReleaseWizardCreator"/>
    </service>
    <service interface="org.onexus.ui.IWizardCreator">
        <bean class="org.onexus.ui.wizards.creators.NewFileWizardCreator"/>
    </service>
    <service interface="org.onexus.ui.IWizardCreator">
        <bean class="org.onexus.ui.wizards.creators.RemoveResourceWizardCreator"/>
    </service>
    <service interface="org.onexus.ui.IWizardCreator">
        <bean class="org.onexus.ui.wizards.creators.NewCollectionWizardCreator"/>
    </service>
    <service interface="org.onexus.ui.IWizardCreator">
        <bean class="org.onexus.ui.wizards.creators.NewWebsiteWizardCreator"/>
    </service>
    <service interface="org.onexus.ui.IWizardCreator">
        <bean class="org.onexus.ui.wizards.creators.ManageCollectionWizardCreator"/>
    </service>

    <!-- Default wizard manager -->
    <reference-list id="wizardCreatorsRef" interface="org.onexus.ui.IWizardCreator" availability="optional"/>
    <service interface="org.onexus.ui.wizards.IWizardsManager">
        <bean class="org.onexus.ui.wizards.DefaultWizardsManager">
            <property name="wizardCreators" ref="wizardCreatorsRef"/>
        </bean>
    </service>

    <!-- Default widget creators -->
    <service interface="org.onexus.ui.website.widgets.IWidgetCreator">
        <bean class="org.onexus.ui.website.widgets.bookmark.BookmarkWidgetCreator"/>
    </service>
    <service interface="org.onexus.ui.website.widgets.IWidgetCreator">
        <bean class="org.onexus.ui.website.widgets.export.ExportWidgetCreator"/>
    </service>
    <service interface="org.onexus.ui.website.widgets.IWidgetCreator">
        <bean class="org.onexus.ui.website.widgets.filters.FiltersWidgetCreator"/>
    </service>
    <service interface="org.onexus.ui.website.widgets.IWidgetCreator">
        <bean class="org.onexus.ui.website.widgets.filters.SelectorFilterWidgetCreator"/>
    </service>
    <service interface="org.onexus.ui.website.widgets.IWidgetCreator">
        <bean class="org.onexus.ui.website.widgets.search.SearchWidgetCreator"/>
    </service>
    <service interface="org.onexus.ui.website.widgets.IWidgetCreator">
        <bean class="org.onexus.ui.website.widgets.tags.TagWidgetCreator"/>
    </service>
    <service interface="org.onexus.ui.website.widgets.IWidgetCreator">
        <bean class="org.onexus.ui.website.widgets.text.TextWidgetCreator"/>
    </service>
    <service interface="org.onexus.ui.website.widgets.IWidgetCreator">
        <bean class="org.onexus.ui.website.widgets.viewselector.ViewerSelectorWidgetCreator"/>
    </service>

    <!-- Default widget manager -->
    <reference-list id="widgetCreatorsRef" interface="org.onexus.ui.website.widgets.IWidgetCreator"
                    availability="optional">
        <reference-listener bind-method="bindCreators" unbind-method="unbindCreators"
                            ref="org.onexus.ui.website.widgets.widgetmanager"/>
    </reference-list>
    <service interface="org.onexus.ui.website.widgets.IWidgetManager"
             ref="org.onexus.ui.website.widgets.widgetmanager"/>
    <bean id="org.onexus.ui.website.widgets.widgetmanager" class="org.onexus.ui.website.widgets.DefaultWidgetManager">
        <property name="resourceRegister" ref="org.onexus.ui.resourceregister"/>
        <property name="creators" ref="widgetCreatorsRef"/>
    </bean>

    <!-- Collection viewers -->
    <service interface="org.onexus.ui.website.viewers.ICollectionViewerCreator">
        <bean class="org.onexus.ui.website.viewers.tableviewer.TableViewerCreator"/>
    </service>

    <!-- CollectionViewerManager -->
    <reference-list id="collectionViewerCreatorsRef" interface="org.onexus.ui.website.viewers.ICollectionViewerCreator"
                    availability="optional">
        <reference-listener bind-method="bindCreators" unbind-method="unbindCreators"
                            ref="org.onexus.ui.website.viewers.collectionviewermanager"/>
    </reference-list>
    <service interface="org.onexus.ui.website.viewers.ICollectionViewerManager"
             ref="org.onexus.ui.website.viewers.collectionviewermanager"/>
    <bean id="org.onexus.ui.website.viewers.collectionviewermanager"
          class="org.onexus.ui.website.viewers.DefaultCollectionViewerManager">
        <property name="resourceRegister" ref="org.onexus.ui.resourceregister"/>
        <property name="creators" ref="collectionViewerCreatorsRef"/>
    </bean>

    <!-- Tabs -->
    <service interface="org.onexus.ui.website.tabs.ITabCreator">
        <bean class="org.onexus.ui.website.tabs.topleft.TopleftTabCreator"/>
    </service>

    <!-- TabManager -->
    <reference-list id="tabCreatorsRef" interface="org.onexus.ui.website.tabs.ITabCreator" availability="optional">
        <reference-listener bind-method="bindCreators" unbind-method="unbindCreators"
                            ref="org.onexus.ui.website.tabs.tabmanager"/>
    </reference-list>
    <service interface="org.onexus.ui.website.tabs.ITabManager" ref="org.onexus.ui.website.tabs.tabmanager"/>
    <bean id="org.onexus.ui.website.tabs.tabmanager" class="org.onexus.ui.website.tabs.DefaultTabManager">
        <property name="resourceRegister" ref="org.onexus.ui.resourceregister"/>
        <property name="creators" ref="tabCreatorsRef"/>
    </bean>


    <!-- Pages -->
    <service interface="org.onexus.ui.website.pages.IPageCreator">
        <bean class="org.onexus.ui.website.pages.browser.BrowserPageCreator"/>
    </service>

    <!-- PageManager -->
    <reference-list id="pageCreatorsRef" interface="org.onexus.ui.website.pages.IPageCreator" availability="optional">
        <reference-listener bind-method="bindCreators" unbind-method="unbindCreators"
                            ref="org.onexus.ui.website.pages.pagemanager"/>
    </reference-list>
    <service interface="org.onexus.ui.website.pages.IPageManager" ref="org.onexus.ui.website.pages.pagemanager"/>
    <bean id="org.onexus.ui.website.pages.pagemanager" class="org.onexus.ui.website.pages.DefaultPageManager">
        <property name="resourceRegister" ref="org.onexus.ui.resourceregister"/>
        <property name="creators" ref="pageCreatorsRef"/>
    </bean>

    <!--  Website activator -->
    <service interface="org.onexus.ui.IResourceActivator">
        <bean class="org.onexus.ui.website.WebsiteActivator"/>
    </service>

</blueprint>